<page-header></page-header>
<main role="main" class="app-main view-testing-session-main">

    <section>
        <div class="section section-bottom-thin" [class.section-light-pink]="modifyInProgress">
            <div class="container-medium-width">
                <div class="modify-testing-session-left">
                    <h2 class="page-sm-heading-teal">Manage Tests</h2>
                    <h3 class="page-lg-heading">View Testing Session {{modifyInProgress ? '— In Progress' : ''}}</h3>
                </div>

                <span *ngIf="modifyInProgress && (adminId==schedule?.adminId || adminId==schedule?.facultyMemberId)">
                    <a [routerLink]="['/tests','modify','add-students']" class="right view-testing-session-link button-mobile-block">Add/Remove Students</a><br>
                    <a [routerLink]="['/tests','modify','schedule-test']" class="right view-testing-session-link button-mobile-block">Change Testing Window</a>
                </span>

                <div class="modify-testing-session-right" *ngIf="modify && !modifyInProgress">
                    <a [routerLink]="['/tests','modify','choose-test',schedule.institutionId]" class="button button-mobile-block">Modify this testing session</a>
                    <button class="anchor-button margin-1em-top" (click)="showConfirmation($event);">Delete this testing session</button>
                </div>
            </div>
        </div>
    </section>

    <section>
        <div class="section section-top-medium-thin ">
            <div class="container-medium-width">
                <a [routerLink]="['/tests']" class="block">Go to Manage Tests main page</a>
                <button id="printButton" (click)="print($event);" class="anchor-button icon print-icon margin-1em-top">Print this page</button>

                <div class="section-medium-thin">
                    <table class="review-details-table table-with-cell-padding justified-ends">
                        <tr>
                            <th scope="row">Testing Session</th>
                            <td>{{schedule?.scheduleName}}</td>
                        </tr>
                        <tr>
                            <th scope="row">Test</th>
                            <td>{{schedule?.testName}}</td>
                        </tr>
                        <tr>
                            <th scope="row">Date and Time</th>
                            <td>
                                <ng-template [ngIf]="!nextDay">
                                    {{schedule?.scheduleStartTime|parseDate:'ddd'}} {{schedule?.scheduleStartTime|parseDate:'MM/DD/YY'}} from {{schedule?.scheduleStartTime|parseDate:'h:mma'}}
                                    &ndash; {{schedule?.scheduleEndTime|parseDate:'h:mma'}}
                                </ng-template>
                                <ng-template [ngIf]="nextDay">
                                    {{schedule?.scheduleStartTime|parseDate:'ddd'}} {{schedule?.scheduleStartTime|parseDate:'MM/DD/YY'}} from {{schedule?.scheduleStartTime|parseDate:'h:mma'}}
                                    &ndash; {{schedule?.scheduleEndTime|parseDate:'h:mma'}} {{schedule?.scheduleEndTime|parseDate:'ddd'}}
                                    {{schedule?.scheduleEndTime|parseDate:'MM/DD/YY'}}
                                </ng-template>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Scheduled by</th>
                            <td>{{schedule?.adminFirstName}} {{schedule?.adminLastName}}</td>
                        </tr>
                        <tr>
                            <th scope="row">Faculty</th>
                            <td>{{schedule?.facultyFirstName}} {{schedule?.facultyLastName}}</td>
                        </tr>
                        <tr>
                            <th scope="row">Created/Modified</th>
                            <td>{{schedule?.lastUpdated|parseDate:'MM/DD/YY'}}</td>
                        </tr>
                        <tr *ngIf="schedule?.testType === 1">
                            <th scope="row">Password</th>
                            <td [ngClass]="enableLink ? 'enable-link' : 'disable-link'">
                                <div class="session-password">
                                    <span class="access-code" *ngIf="showAccessCode">{{decryptedAccessCode}}</span>
                                    <span class="password-label" (click)="togglePassword($event)">{{passwordLabel}}</span>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>

                <h4 class="teal inline">Students in Testing Session ({{schedule?.selectedStudents?.length}})</h4>
                <div class="margin-1em-bottom" *ngIf="ItSecurityEnabled && +(schedule.testType)!==7" >
                    <input type="checkbox" class="checkbox-image" [attr.id]="chkSecurityView" name="chkSecurityView" [checked]="chkSecurityView" disabled="disabled" />
                    <label *ngIf="schedule.itSecurityEnabledInstitution == 1" [attr.for]="chkSecurityView"><b>Enable Examity</b></label>
                    <label *ngIf="schedule.itSecurityEnabledInstitution == 3" [attr.for]="chkSecurityView"><b>Enable Proctortrack</b></label>
                </div>
                <table id="studentsInTestingSessionTable" class="table-with-cell-padding table-striped last-row-no-border" *ngIf="!(!schedule.isExamity && schedule.testType===1)">
                    <thead>
                        <tr>
                            <th scope="col">Last Name</th>
                            <th scope="col">First Name</th>
                            <th scope="col">Cohort</th>
                            <th scope="col">Test</th>
                            <th scope="col">Norming Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let student of schedule?.selectedStudents">
                            <td [class.name-with-pay-alert]="student.StudentPay && testStatus > -1">{{student.LastName}}<img *ngIf="student.StudentPay && testStatus > -1" src="assets/images/self-pay-alert-icon.svg"
                                    class="self-pay-alert-table-icon" alt="payment alert icon" /></td>
                            <td>{{student.FirstName}}</td>
                            <td>{{student.CohortName}}</td>
                            <td>{{student.StudentTestName}}</td>
                            <td>{{student.NormingStatus ? student.NormingStatus : schedule.testNormingStatus}}</td>
                        </tr>

                    </tbody>
                </table>

                <div  class="margin-1em-top" *ngIf="!schedule.isExamity && schedule.testType===1">
                    <faculty-approval
                        [schedule]="schedule">
                    </faculty-approval>
                </div>

                <div class="icon-container-flush-text">
                    <p class="icon info-icon-yellow margin-1em-top" *ngIf="hasADA">One or more of the students you have added have testing accommodations.  Their test will be untimed.  To designate additional students who need extended timing accommodations or to verify who is currently set with accommodations, please submit your request in the "Manage Cohorts" section.  For questions please contact your Account Manager. </p>
                    <p class="icon info-icon-yellow margin-1em-top" *ngIf="!hasADA">If you need to request extended timing accommodations for any students on this list who have not been previously set with this accommodation, please submit your request in the "Manage Cohorts" section.  For questions please contact your Account Manager.</p>
                    <img *ngIf="anyStudentPayStudents && testStatus > -1" src="assets/images/self-pay-alert-icon.svg" class="self-pay-alert-icon" alt="payment alert icon"
                         height="22" width="22" />
                    <p *ngIf="anyStudentPayStudents && testStatus > -1">
                        These students have been deactivated due to non-payment. They will not be able to access their test during the specified
                        testing window unless their balance is paid in full at least two business days prior to test day.
                    </p>

                </div>

                <div class="margin-2em-top">
                    <div class="modify-testing-session-left margin-2em-bottom">
                        <a [routerLink]="['/tests']" class="block">Go to Manage Tests main page</a>
                    </div>
                    <div class="modify-testing-session-right" *ngIf="modify && !modifyInProgress">
                        <a [routerLink]="['/tests','modify','choose-test',schedule.institutionId]" class="button button-mobile-block">Modify this testing session</a>
                        <button class="anchor-button margin-1em-top" (click)="showConfirmation($event);">Delete this testing session</button>
                    </div>
                </div>

            </div>
        </div>
    </section>
</main>
<page-footer></page-footer>
<confirmation-popup popupId="confirmationPopup" message="Are you sure you want to delete this testing session? This cannot be undone." okButtonText="Yes, delete"
                    cancelButtonText="No, do not delete" (onOK)="onOKConfirmation($event)" (onCancel)="onCancelConfirmation($event)" hideClose="false">
</confirmation-popup>
